# -*- coding: utf-8 -*-
BT = chr(96)*3
path = "docs/API.md"
parts = []parts.append('\n\n## 预警管理（/api/alert）\n\n### GET /api/alert/rules\n**描述**: 获取所有预警规则列表\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"rules": [], "total": 0}}\n{BT}\n\n### POST /api/alert/rules\n**描述**: 创建新预警规则\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| id | string | 是 | 规则唯一ID |\n| name | string | 是 | 规则名称 |\n| alert_type | string | 否 | 预警类型，默认 custom |\n| level | string | 否 | 预警级别（info/warning/danger），默认 warning |\n| conditions | object | 否 | 触发条件，默认 {} |\n| cooldown_minutes | integer | 否 | 冷却时间（分钟），默认 30 |\n**响应示例**:\n{BT}json\n{"code": 201, "msg": "预警规则创建成功", "data": {"rule": {"id": "rule_001", "enabled": true}}}\n{BT}\n\n### PUT /api/alert/rules/<rule_id>\n**描述**: 更新指定预警规则\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| name | string | 否 | 规则名称 |\n| enabled | boolean | 否 | 是否启用 |\n| conditions | object | 否 | 触发条件 |\n| cooldown_minutes | integer | 否 | 冷却时间（分钟） |\n| level | string | 否 | 预警级别 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "预警规则更新成功", "data": {"rule_id": "rule_001"}}\n{BT}\n\n### DELETE /api/alert/rules/<rule_id>\n**描述**: 删除指定预警规则\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "预警规则删除成功", "data": {"rule_id": "rule_001"}}\n{BT}\n\n### POST /api/alert/rules/<rule_id>/toggle\n**描述**: 切换预警规则启用/禁用状态\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "预警规则已启用", "data": {"rule_id": "rule_001", "enabled": true}}\n{BT}\n\n### GET /api/alert/history\n**描述**: 获取预警历史记录\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| limit | integer | 否 | 返回条数，默认 50，最大 200 |\n| level | string | 否 | 按级别筛选 |\n| unread_only | boolean | 否 | 仅返回未读，默认 false |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"alerts": [], "total": 0}}\n{BT}\n\n### GET /api/alert/stats\n**描述**: 获取预警统计信息\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"total": 10, "unread": 3}}\n{BT}\n\n### GET /api/alert/unread-count\n**描述**: 获取未读预警数量\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"unread_count": 3}}\n{BT}\n\n### POST /api/alert/<alert_id>/read\n**描述**: 标记指定预警为已读\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "已标记为已读", "data": {"alert_id": "alert_001"}}\n{BT}\n\n### POST /api/alert/read-all\n**描述**: 标记所有预警为已读\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "已标记5条预警为已读", "data": {"marked_count": 5}}\n{BT}\n\n### POST /api/alert/test\n**描述**: 发送测试预警（通过 WebSocket 广播），限速 5次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| type | string | 否 | 预警级别，默认 info |\n| message | string | 否 | 预警消息内容 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "测试预警已发送", "data": {"alert": {"id": "test_20260222", "level": "info"}}}\n{BT}\n\n### POST /api/alert/evaluate\n**描述**: 提交数据评估是否触发预警规则，限速 30次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| type | string | 是 | 评估类型：volume_spike / negative_surge / sentiment_shift / hot_topic |\n| current_count | integer | 否 | 当前数量（volume_spike 用） |\n| baseline_count | integer | 否 | 基线数量（volume_spike 用） |\n| negative_count | integer | 否 | 负面数量（negative_surge 用） |\n| total_count | integer | 否 | 总数量（negative_surge 用） |\n| current_sentiment | float | 否 | 当前情感分（sentiment_shift 用） |\n| previous_sentiment | float | 否 | 历史情感分（sentiment_shift 用） |\n| topic_mentions | integer | 否 | 话题提及次数（hot_topic 用） |\n| topic_name | string | 否 | 话题名称（hot_topic 用） |\n| time_window | integer | 否 | 时间窗口（分钟），默认 60 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"triggered": true, "alert": {"level": "warning", "title": "讨论量激增"}}}\n{BT}\n')
parts.append('\n\n---\n\n## 报告生成（/api/report）\n\n### POST /api/report/generate\n**描述**: 生成单个格式报告（PDF 或 PPT），限速 5次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| format | string | 否 | 报告格式：pdf / ppt，默认 pdf |\n| title | string | 否 | 报告标题，默认舆情分析报告 |\n| template | string | 否 | 模板ID：brief / standard / detailed，默认 standard |\n| sections | array | 否 | 自定义章节列表，不传则由模板决定 |\n| data | object | 否 | 报告数据，不传则使用演示数据 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "报告生成成功", "data": {"download_url": "/api/report/download/report_20260222.pdf", "format": "pdf", "generated_at": "2026-02-22T12:00:00"}}\n{BT}\n\n### POST /api/report/generate-all\n**描述**: 同时生成所有格式报告（PDF + PPT），限速 3次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| title | string | 否 | 报告标题 |\n| data | object | 否 | 报告数据，不传则使用演示数据 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "报告生成成功", "data": {"files": {"pdf": {"download_url": "/api/report/download/report.pdf"}, "ppt": {"download_url": "/api/report/download/report.pptx"}}, "generated_at": "2026-02-22T12:00:00"}}\n{BT}\n\n### GET /api/report/download/<filename>\n**描述**: 下载已生成的报告文件（作为附件）\n**认证**: 无需认证\n**响应**: 文件流（attachment）\n\n### GET /api/report/preview/<filename>\n**描述**: 在线预览已生成的报告文件（内联）\n**认证**: 无需认证\n**响应**: 文件流（inline）\n\n### GET /api/report/templates\n**描述**: 获取可用报告模板列表\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"templates": [{"id": "brief", "name": "简报"}, {"id": "standard", "name": "标准报告"}, {"id": "detailed", "name": "详细报告"}]}}\n{BT}\n\n### GET /api/report/demo-data\n**描述**: 获取报告演示数据（用于前端预览）\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"summary": {"total_articles": 12580}, "hot_topics": [], "trend": []}}\n{BT}\n')
parts.append('\n\n---\n\n## 传播路径分析（/api/propagation）\n\n### GET /api/propagation/analyze/<article_id>\n**描述**: 分析指定文章的传播路径，返回节点数与摘要统计\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| demo | boolean | 否 | 是否使用演示数据，默认 true |\n| count | integer | 否 | 演示节点数量，默认 100 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"article_id": "123", "node_count": 100, "summary": {"max_depth": 5, "total_reposts": 99}}}\n{BT}\n\n### GET /api/propagation/graph/<article_id>\n**描述**: 获取传播图节点与边数据，用于前端可视化渲染\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| demo | boolean | 否 | 是否使用演示数据，默认 true |\n| count | integer | 否 | 演示节点数量，默认 80 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"nodes": [], "edges": []}}\n{BT}\n\n### GET /api/propagation/kol/<article_id>\n**描述**: 获取文章传播中的 KOL 节点及用户影响力排名\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| demo | boolean | 否 | 是否使用演示数据，默认 true |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"article_id": "123", "kol_count": 5, "kol_nodes": [], "user_ranking": []}}\n{BT}\n\n### GET /api/propagation/timeline/<article_id>\n**描述**: 获取传播时间线（按时间间隔统计转发量）\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| interval | integer | 否 | 时间间隔（分钟），默认 60 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"article_id": "123", "interval_minutes": 60, "timeline": []}}\n{BT}\n\n### GET /api/propagation/depth/<article_id>\n**描述**: 获取传播深度分布（各层级节点数量）\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"article_id": "123", "depth_distribution": {"0": 1, "1": 10}, "max_depth": 5}}\n{BT}\n\n### POST /api/propagation/compare\n**描述**: 对比多篇文章的传播路径指标，限速 10次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| article_ids | array | 是 | 文章ID列表，至少 2 个，最多 5 个 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"comparison": [{"article_id": "123", "total_nodes": 100, "total_depth": 5, "kol_count": 3}]}}\n{BT}\n')
parts.append('\n\n---\n\n## 收藏管理（/api/favorites）\n\n### POST /api/favorites/<article_id>\n**描述**: 收藏指定文章（幂等，已收藏则直接返回成功）\n**认证**: 需要 JWT Token\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "收藏成功", "data": null}\n{BT}\n\n### DELETE /api/favorites/<article_id>\n**描述**: 取消收藏指定文章\n**认证**: 需要 JWT Token\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "已取消收藏", "data": null}\n{BT}\n\n### GET /api/favorites/check/<article_id>\n**描述**: 检查当前用户是否已收藏指定文章\n**认证**: 需要 JWT Token\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"favorited": true}}\n{BT}\n\n### GET /api/favorites\n**描述**: 获取当前用户的收藏列表（分页，含文章详情）\n**认证**: 需要 JWT Token\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| page | integer | 否 | 页码，默认 1 |\n| limit | integer | 否 | 每页条数，默认 10，最大 50 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"items": [{"article_id": "123", "content": "...", "favorited_at": "2026-02-22"}], "total": 1, "page": 1, "limit": 10}}\n{BT}\n\n### POST /api/favorites/batch-check\n**描述**: 批量检查多篇文章的收藏状态（最多 100 篇）\n**认证**: 需要 JWT Token\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| article_ids | array | 是 | 文章ID列表，最多 100 个 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"favorites": {"123": true, "456": false}}}\n{BT}\n')
parts.append('\n\n---\n\n## 审计日志（/api/audit）\n\n### GET /api/audit/logs\n**描述**: 获取安全审计日志列表（分页），仅管理员可访问\n**认证**: 需要 JWT Token（管理员）\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| page | integer | 否 | 页码，默认 1 |\n| limit | integer | 否 | 每页条数，默认 20，最大 100 |\n| action | string | 否 | 按操作类型精确筛选 |\n| username | string | 否 | 按用户名模糊筛选 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"items": [{"id": 1, "username": "admin", "action": "login", "ip": "127.0.0.1", "created_at": "2026-02-22"}], "total": 1, "page": 1, "limit": 20}}\n{BT}\n')
parts.append('\n\n---\n\n## 多平台数据（/api/platform）\n\n### GET /api/platform/list\n**描述**: 获取支持的平台列表及启用状态\n**认证**: 无需认证\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"platforms": [{"id": "weibo", "name": "微博", "enabled": true}, {"id": "bilibili", "name": "B站", "enabled": false}]}}\n{BT}\n\n### GET /api/platform/data/<platform>\n**描述**: 获取指定平台的内容数据（分页），限速 30次/分钟\n**认证**: 无需认证\n**路径参数**: platform 可选值：weibo / wechat / douyin / zhihu / bilibili\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| page | integer | 否 | 页码，默认 1 |\n| page_size | integer | 否 | 每页条数，默认 20，最大 100 |\n| demo | boolean | 否 | 是否使用演示数据，默认 true |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"platform": "weibo", "data": [], "pagination": {"page": 1, "page_size": 20, "total": 50, "total_pages": 3}}}\n{BT}\n\n### GET /api/platform/all\n**描述**: 获取多个平台的汇总数据，限速 20次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| platforms | string | 否 | 逗号分隔的平台ID，默认 weibo,wechat,douyin,zhihu |\n| page_size | integer | 否 | 每平台返回条数，默认 10 |\n| demo | boolean | 否 | 是否使用演示数据，默认 true |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"platforms": {"weibo": {"count": 10, "total_likes": 5000}}, "summary": {"total_content": 40}}}\n{BT}\n\n### GET /api/platform/stats/<platform>\n**描述**: 获取指定平台（或全部平台）的统计数据，限速 30次/分钟\n**认证**: 无需认证\n**路径参数**: platform 传 all 则返回所有平台统计\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"weibo": {"total_content": 12000, "positive_ratio": 0.52, "top_keywords": []}}}\n{BT}\n\n### POST /api/platform/compare\n**描述**: 对比多个平台的内容指标，限速 10次/分钟\n**认证**: 无需认证\n**请求参数**:\n| 参数 | 类型 | 必填 | 说明 |\n|------|------|------|------|\n| platforms | array | 是 | 平台ID列表，至少 2 个 |\n**响应示例**:\n{BT}json\n{"code": 200, "msg": "success", "data": {"comparison": {"weibo": {"avg_likes": 320, "sentiment_distribution": {"positive": 10}}}, "metrics": ["total_content", "avg_likes"]}}\n{BT}\n')

full = ''.join(parts).replace('{BT}', BT)
with open(path, 'a', encoding='utf-8') as out:
    out.write(full)
print('Done, wrote', len(full), 'chars')
